# Story 3.2: Implement Guild Event Registration & Basic Leaderboard API

## Status

In Progress

## Ownership

*   **Primary Owner (Social Service):** Minh Anh / An
*   **Primary Owner (Code Battle Service):** Phuc

## Target Deadline

Thursday, 23/10/2025

## Story

**As a** Guild Master,
**I want** to be able to register my guild for an approved event via an API, and **as a developer**, I need a way to fetch basic leaderboard results.

## Acceptance Criteria

1. An endpoint `POST /api/events/{eventId}/register-guild` is created in the `SocialService` that allows a Guild Master to register their guild for an event.
2. This endpoint performs a **service-to-service call** to the `CodeBattleService` to validate that the `eventId` is valid and the event is 'Approved'.
3. A `GET /api/events/{eventId}/leaderboard` endpoint is created in the `CodeBattleService` that returns a simple, non-real-time list of top scores for a completed event.
4. The registration endpoint is protected, requiring an authenticated user who is a Guild Master.
5. The leaderboard endpoint is public or requires standard authentication.

## Tasks / Subtasks

- [ ] **Task 1 (Social Service - Minh Anh / An): Create Guild Registration Endpoint** (AC: #1, #4)
    - [ ] Implement the `POST /api/events/{eventId}/register-guild` endpoint in a new `EventsController`.
    - [ ] The handler logic must extract the user's `guildId` from their claims or database record.
    - [ ] Secure the endpoint to ensure only Guild Masters can perform this action.
- [ ] **Task 2 (Social Service - Minh Anh / An): Implement Service-to-Service Client** (AC: #2)
    - [ ] Create a typed `HttpClient` or service client in the `SocialService` to communicate with the `CodeBattleService`.
    - [ ] Implement the logic to call the `CodeBattleService` to verify the event's status before completing registration.
- [ ] **Task 3 (Code Battle Service - Phuc): Create Event Validation Endpoint** (AC: #2)
    - [ ] In the Go service, create an **internal** endpoint (e.g., `GET /internal/events/{eventId}/status`) that the `SocialService` can call to check if an event is valid and approved.
- [ ] **Task 4 (Code Battle Service - Phuc): Create Basic Leaderboard Endpoint** (AC: #3, #5)
    - [ ] In the Go service, implement the public-facing `GET /api/events/{eventId}/leaderboard` endpoint.
    - [ ] This endpoint should query the `submissions` or a `leaderboard_entries` table and return a ranked list of scores. **Real-time functionality is NOT required for this story.**
- [ ] **Task 5 (Team): Integration Testing**
    - [ ] Write an integration test in the `SocialService` that mocks the `CodeBattleService` response to test the registration logic.
    - [ ] Write an integration test in the `CodeBattleService` for the leaderboard endpoint.