# Story 3.1: Expose Core Event Management & Approval APIs

## Status


Move to the next sprint

## Ownership

*   **Primary Owner:** Phuc (Event Service)
*   **Rationale:** As the owner of the former Code Battle service, Phuc is now the owner of the consolidated Event Service and is responsible for its core APIs.

## Target Deadline

Thursday, 23/10/2025

## Story

**As a** Game Master (Admin),
**I want** a set of secure APIs in the new **Event Service** to create, manage, and approve competitive events,
**so that** I can administer the lifecycle of a code battle competition from the backend.

## Acceptance Criteria

1. A new `Admin/EventsController` is created in the **Event Service** (.NET or Go, TBD by team).
2. The controller exposes the following endpoints, all protected by the 'Game Master' role:
   - `POST /api/admin/events`: Creates a new event, storing it in the database with a 'PendingApproval' status.
   - `GET /api/admin/events/pending`: Returns a list of all events awaiting approval.
   - `POST /api/admin/events/{eventId}/approve`: Changes an event's status to 'Approved'.
3. The logic correctly persists `Event` data to the **Event Service's dedicated database**.
4. All endpoints are fully documented in the OpenAPI/Swagger specification for the **Event Service**.
5. Integration tests are written to verify that only a 'Game Master' can access these endpoints and that the event lifecycle (Create -> Approve) functions correctly.

## Tasks / Subtasks

- [ ] **Task 1: Set up CQRS for Event Lifecycle in Event Service**
    - [ ] Create MediatR commands: `CreateEventCommand`, `ApproveEventCommand`.
    - [ ] Create MediatR queries: `GetPendingEventsQuery`.
    - [ ] Implement the corresponding handlers with business logic within the Event Service.
- [ ] **Task 2: Implement `Admin/EventsController` in Event Service** (AC: #1, #2)
    - [ ] Create the controller and its actions for creating, listing pending, and approving events.
- [ ] **Task 3: Secure Endpoints** (AC: #5)
    - [ ] Apply the `[Authorize(Roles = "Game Master")]` attribute to the controller.
    - [ ] Verify that the JWT middleware correctly rejects non-admin users.
- [ ] **Task 4: Write Integration Tests** (AC: #5)
    - [ ] Write integration tests using the appropriate framework for the Event Service (`WebApplicationFactory` for .NET, standard testing for Go).
    - [ ] Include tests for both successful admin access and `403 Forbidden` responses for non-admin users.
