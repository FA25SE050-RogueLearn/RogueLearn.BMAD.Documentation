# **Story 1.7: Class Roadmap Import (roadmap.sh)**

## Status

Draft

## Story

**As a** Data Integrations Engineer,
**I want** to import roadmap.sh content into the User Serviceâ€™s Class and academic structures,
**so that** Classes are enriched with standardized skill paths and topics aligned with industry roadmaps.

## Acceptance Criteria

1. Import Source & Mapping
   - Read roadmap content from `extracted-data/roadmap-extracted/aspnet-core.json` (initial target) and map to domain entities.
   - Map roadmap topics to `classes`, `class_topics` (or equivalent), difficulty levels, and prerequisite relationships.
2. Idempotent Import Process
   - Import operation upserts records; re-running import does not duplicate data.
   - Generate an import report summarizing created/updated/skipped records and any validation warnings.
3. Trigger Mechanism
   - Admin-only endpoint: `POST /api/admin/classes/import-roadmap` with parameters `{source: "aspnet-core"}` (future sources extensible).
   - Optional CLI/Job trigger supports scheduled imports.
4. Validation & Error Handling
   - Validate JSON schema, required fields, and mapping consistency.
   - Return friendly errors and detailed report for failures.
5. Documentation
   - OpenAPI docs for import endpoint including report schema.
6. Testing
   - Integration tests using TestContainers (PostgreSQL) that run an import against the provided `aspnet-core.json`, assert correct mappings, and idempotency.

## Tasks / Subtasks

- [ ] Task 1: Data Model Review & Extensions
  - [ ] Confirm existing tables for classes and relationships (e.g., `classes`, `class_topics`, `class_prerequisites`).
  - [ ] Add migrations if a `class_topics` or mapping table is needed (topic, slug, section, difficulty).
- [ ] Task 2: Parser & Mapper
  - [ ] Implement a parser for roadmap JSON format (start with `aspnet-core.json`).
  - [ ] Implement a mapper that translates parsed nodes into class entities and relationships.
  - [ ] Define difficulty normalization (e.g., Beginner/Intermediate/Advanced) based on source metadata.
- [ ] Task 3: Import Service
  - [ ] Create `ClassRoadmapImportService` that orchestrates parsing, mapping, upsert, and reporting.
  - [ ] Ensure idempotency via deterministic keys (slug/section) and conflict handling.
- [ ] Task 4: API & Job Trigger
  - [ ] Create `AdminClassesController` endpoint: `POST /api/admin/classes/import-roadmap`.
  - [ ] Optional background job or CLI command for scheduled imports.
- [ ] Task 5: Reporting & Error Handling
  - [ ] Define `ImportReport` DTO with counts and warnings; return on completion.
  - [ ] Add detailed logging for created/updated/skipped items.
- [ ] Task 6: OpenAPI & CI
  - [ ] Document endpoint and report schema; verify in CI.
- [ ] Task 7: Testing
  - [ ] Integration tests that execute import against `extracted-data/roadmap-extracted/aspnet-core.json`.
  - [ ] Idempotency test: run import twice and assert no duplicates.

## Dev Notes

### Driving Requirements
- Align class definitions with standardized roadmaps to improve curriculum coherence and skill path visibility.

*Source: `docs/fullstack-architecture/service-databases/user-service-database.md`*

### Architectural Guidance
- Implement within `roguelearn-api/UserService` as it owns academic structures and Classes.
- Use Admin RBAC and shared JWT validation middleware.

*Source: `docs/fullstack-architecture/backend-architecture.md`, `docs/fullstack-architecture/api-specification.md`*

### Data Sources
- Primary: <mcfile name="aspnet-core.json" path="d:\Code Stuffs\MinhAnh2610\RogueLearn.BMAD.Documentation\extracted-data\roadmap-extracted\aspnet-core.json"></mcfile>
- Reference: <mcfile name="aspnet-core.pdf" path="d:\Code Stuffs\MinhAnh2610\RogueLearn.BMAD.Documentation\extracted-data\roadmap\aspnet-core.pdf"></mcfile>

### Testing Strategy
- Use WebApplicationFactory and TestContainers for end-to-end import validation.

*Source: `docs/prd/technical-guidance.md`*

## Change Log

| Date | Version | Description | Author |
| :--- | :--- | :--- | :--- |
| [Current Date] | 1.0 | Initial story draft | Bob, SM |

## Dev Agent Record

### Agent Model Used
_TBD by Dev Agent_

### Debug Log References
_TBD by Dev Agent_

### Completion Notes List
_TBD by Dev Agent_

### File List
_TBD by Dev Agent_

## QA Results
_TBD by QA Agent_