# Story 4.5: Party Stash (Shared Resources) with Role-Based Permissions

## Status

Draft

## Ownership

* **Primary Owner (Social Service):** Minh Anh / An
* **Primary Owner (Frontend):** Duong

## Target Deadline

Thursday, 30/10/2025

## Story

**As a** Party Leader,
**I want** a shared resource space (Party Stash) with per-member permissions (view/edit/comment),
**so that** the party can collaboratively manage notes and resources.

## Acceptance Criteria

1. Data model in Social Service:
   - `PartyStashItem` (id, partyId, title, type: note|link|file, content/url, createdBy, createdAt, updatedAt).
   - `PartyStashPermission` (partyId, userId, permission: view|comment|edit). Default: Members have `view`, Leader has `edit`.
2. APIs:
   - `GET /api/parties/{partyId}/stash` — List items (respect user permissions).
   - `POST /api/parties/{partyId}/stash` — Create item (requires `edit`).
   - `PUT /api/parties/{partyId}/stash/{itemId}` — Update item (requires `edit`).
   - `DELETE /api/parties/{partyId}/stash/{itemId}` — Delete item (requires `edit`).
   - `POST /api/parties/{partyId}/permissions` — Set per-user permissions (Leader-only).
3. Frontend:
   - `/social/party/stash` page listing items with actions gated by permission.
   - Components: StashList, StashItemCard, StashEditor (note/link/file types), PermissionManager.
4. Validation & Rules:
   - Only Leader can change permissions.
   - Edit requires `edit` permission; comment UI shown for `comment` permission (discussion thread per item).
5. OpenAPI docs updated; integration tests for permissions and CRUD operations.

## Tasks / Subtasks

- [ ] Task 1: Data Model & Migrations (AC: #1)
  - [ ] Create `PartyStashItem` and `PartyStashPermission` tables with indexes.
- [ ] Task 2: Service & Controllers (AC: #2, #4)
  - [ ] Implement CRUD operations and permission management with role checks.
- [ ] Task 3: Frontend Page & Components (AC: #3)
  - [ ] Build `/social/party/stash` and related components; integrate mock data first.
- [ ] Task 4: OpenAPI & Tests (AC: #5)
  - [ ] Document endpoints and write integration tests for permission enforcement and CRUD.