# Story 4.6: Party Policy & Matchmaking (Open/Closed, Discovery)

## Status

Draft

## Ownership

* **Primary Owner (Social Service):** Minh Anh / An
* **Primary Owner (Frontend):** Duong

## Target Deadline

Thursday, 30/10/2025

## Story

**As a** Party Leader,
**I want** to configure party policy (open vs closed) and allow users to discover and request to join parties,
**so that** forming parties is fast and flexible.

## Acceptance Criteria

1. Data additions:
   - `PartyPolicy` fields on Party: `openJoin: boolean`, `discoverable: boolean`, `tags: string[]` (optional), `minLevel` (optional).
2. APIs:
   - `POST /api/parties/{partyId}/policy` — Update policy (Leader-only). Fields: `openJoin`, `discoverable`, optional `minLevel`.
   - `GET /api/parties/discover?query=&tag=&page=` — Discover parties (filter by name/tags), returns summary: id, name, leaderDisplayName, memberCount, openJoin.
   - `POST /api/parties/{partyId}/requests` — Create join request if not openJoin; Leader can accept/deny.
   - `GET /api/parties/{partyId}/requests` — List pending requests (Leader-only).
   - `POST /api/parties/{partyId}/requests/{requestId}/approve` — Approve a request.
   - `POST /api/parties/{partyId}/requests/{requestId}/deny` — Deny a request.
3. Frontend:
   - `/social/party/discover` page to browse discoverable parties, show open-join or request-to-join.
   - `/social/party/{partyId}/requests` page for leaders to review/approve.
4. Validation & Rules:
   - Enforce capacity checks and `minLevel` if set.
   - Prevent duplicate requests; auto-accept if openJoin.
5. OpenAPI docs updated; integration tests for discovery and request flows.

## Tasks / Subtasks

- [ ] Task 1: Policy Model & Migrations (AC: #1)
  - [ ] Add policy fields to Party table with indexes for discoverability.
- [ ] Task 2: Services & Controllers (AC: #2, #4)
  - [ ] Implement policy update, discovery search, requests CRUD, approval/denial.
- [ ] Task 3: Frontend Pages (AC: #3)
  - [ ] Build discovery and requests pages with mock data, then wire to APIs.
- [ ] Task 4: OpenAPI & Tests (AC: #5)
  - [ ] Document endpoints; integration tests for discovery and join request flows.