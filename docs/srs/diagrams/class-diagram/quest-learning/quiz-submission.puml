' quiz-submission-class.puml
@startuml
skinparam linetype ortho
skinparam ranksep 50
skinparam nodesep 50
skinparam classAttributeIconSize 0
hide empty members

package "API Layer" {
    class QuestsController {
        - _mediator: IMediator
        + SubmitQuizAnswer(questId, stepId, activityId, body): Task<IActionResult>
    }
}

package "Application Layer" {
    class SubmitQuizAnswerCommand {
        + AuthUserId: Guid
        + QuestId: Guid
        + StepId: Guid
        + ActivityId: Guid
        + Answers: Dictionary<string, string>
        + CorrectAnswerCount: int
        + TotalQuestions: int
    }

    class SubmitQuizAnswerHandler {
        + Handle(command, cancellationToken)
        - CalculateGrade()
    }
    
    class SubmitQuizAnswerResponse {
        + SubmissionId: Guid
        + ScorePercentage: double
        + IsPassed: boolean
        + Message: string
    }
}

package "Domain & Infrastructure Layer" {
    interface IQuestSubmissionRepository
    interface IUserQuestStepProgressRepository
    interface IUserSkillRewardRepository
    interface IQuestStepRepository
    
    class QuestSubmission {
        + Id: Guid
        + AttemptId: Guid
        + SubmissionData: string (JSON)
        + Grade: double
        + IsPassed: boolean
    }
    
    class UserQuestStepProgress {
        + Id: Guid
        + CompletedActivityIds: List<Guid>
        + Status: StepCompletionStatus
    }
}

' Formatting
QuestsController -[hidden]- SubmitQuizAnswerCommand
SubmitQuizAnswerHandler -[hidden]- IQuestSubmissionRepository

' Relationships
QuestsController ..> SubmitQuizAnswerCommand : Creates
QuestsController ..> SubmitQuizAnswerHandler : Sends via Mediator

SubmitQuizAnswerHandler ..> SubmitQuizAnswerCommand : Uses
SubmitQuizAnswerHandler ..> SubmitQuizAnswerResponse : Returns

SubmitQuizAnswerHandler --> IQuestSubmissionRepository
SubmitQuizAnswerHandler --> IUserQuestStepProgressRepository
SubmitQuizAnswerHandler --> IUserSkillRewardRepository
SubmitQuizAnswerHandler --> IQuestStepRepository

IQuestSubmissionRepository ..> QuestSubmission : Stores
IUserQuestStepProgressRepository ..> UserQuestStepProgress : Updates
@enduml