@startuml
skinparam linetype ortho
skinparam ranksep 60
skinparam nodesep 60
skinparam classAttributeIconSize 0
hide empty members

package "API Layer" {
    class UsersController {
        - _mediator: IMediator
        + ProcessMyAcademicRecord(fapHtmlContent, programId)
    }
}

package "Application Layer" {
    class GenerateQuestLineCommand {
        + AuthUserId: Guid
    }

    class GenerateQuestLineCommandHandler {
        + Handle(command, cancellationToken)
    }

    class GenerateQuestLineResponse {
        + LearningPathId: Guid
    }

    interface IQuestDifficultyResolver {
        + ResolveDifficulty(subjectRecord)
    }

    class QuestDifficultyResolver {
        + ResolveDifficulty(subjectRecord)
        - TryParseGrade(grade)
    }
}

package "Domain & Infrastructure Layer" {
    interface IUserProfileRepository
    interface ISubjectRepository
    interface IStudentSemesterSubjectRepository
    interface IQuestRepository
    interface IUserQuestAttemptRepository

    class UserProfile
    class Subject
    class StudentSemesterSubject
    class Quest
    class UserQuestAttempt
}

' Relationships
UsersController ..> GenerateQuestLineCommand : Creates
UsersController ..> GenerateQuestLineCommandHandler : Sends via Mediator

GenerateQuestLineCommandHandler ..> GenerateQuestLineCommand : Uses
GenerateQuestLineCommandHandler ..> GenerateQuestLineResponse : Returns
GenerateQuestLineCommandHandler --> IQuestDifficultyResolver
IQuestDifficultyResolver <|.. QuestDifficultyResolver

GenerateQuestLineCommandHandler --> IUserProfileRepository
GenerateQuestLineCommandHandler --> ISubjectRepository
GenerateQuestLineCommandHandler --> IStudentSemesterSubjectRepository
GenerateQuestLineCommandHandler --> IQuestRepository
GenerateQuestLineCommandHandler --> IUserQuestAttemptRepository

IUserQuestAttemptRepository ..> UserQuestAttempt : Persists
IQuestRepository ..> Quest : Reads
@enduml