' generate-quest-steps-class.puml
@startuml
skinparam linetype ortho
skinparam ranksep 50
skinparam nodesep 50
skinparam classAttributeIconSize 0
hide empty members

package "API Layer" {
    class QuestsController {
        - _backgroundJobClient: IBackgroundJobClient
        + GenerateQuestSteps(questId): Task<IActionResult>
    }
}

package "Application Layer" {
    interface IQuestStepGenerationService {
        + GenerateQuestStepsAsync(authUserId, questId, context)
    }

    class QuestStepGenerationService {
        + GenerateQuestStepsAsync()
        - CreateStepEntities()
    }
    
    interface IQuestGenerationPlugin {
        + GenerateWeeklyContentAsync(topic, syllabus)
    }

    interface ITopicGrouperService {
        + GroupSessionsIntoModules(syllabus)
    }

    class QuestStepsPromptBuilder {
        + BuildWeeklyContentPrompt()
    }
}

package "Domain & Infrastructure Layer" {
    class HangfireBackgroundJob
    class QuestGenerationPlugin
    class TopicGrouperService
    
    interface IQuestStepRepository
    interface IQuestRepository
    
    class QuestStep {
        + Content (JSON)
        + DifficultyVariant
        + ModuleNumber
    }
    
    class Quest {
        + Title
        + SubjectId
    }
}

' Formatting
QuestsController -[hidden]- IQuestStepGenerationService
QuestStepGenerationService -[hidden]- IQuestStepRepository

' Relationships
QuestsController ..> IQuestStepGenerationService : Schedules via Hangfire
IQuestStepGenerationService <|.. QuestStepGenerationService
QuestStepGenerationService <.. HangfireBackgroundJob : Executes

QuestStepGenerationService --> IQuestGenerationPlugin
QuestStepGenerationService --> ITopicGrouperService
QuestStepGenerationService --> IQuestRepository
QuestStepGenerationService --> IQuestStepRepository
QuestStepGenerationService ..> QuestStepsPromptBuilder : Uses

IQuestGenerationPlugin <|.. QuestGenerationPlugin
ITopicGrouperService <|.. TopicGrouperService
IQuestStepRepository ..> QuestStep : Manages
IQuestRepository ..> Quest : Retrieves
@enduml