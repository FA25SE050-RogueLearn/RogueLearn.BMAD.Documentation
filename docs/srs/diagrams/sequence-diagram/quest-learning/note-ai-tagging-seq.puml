@startuml
actor User
participant NoteManagementUI as UI
participant ":NotesController" as Controller
participant ":CreateNoteWithAI\nHandler" as Handler
participant ":Summarization\nPlugin" as Summarizer
participant ":Tagging\nService" as Tagger
database ":Database" as DB

User -> UI : Upload File / Paste Text
activate UI

UI -> Controller : Request Create (POST)
activate Controller

Controller -> Handler : Handle(command)
activate Handler

Handler -> Summarizer : Summarize Content
activate Summarizer
Summarizer --> Handler : Structured Content (JSON)
deactivate Summarizer

Handler -> DB : Save Note (Content Only)
activate DB
DB --> Handler : NoteId
deactivate DB

Handler -> Tagger : Request Tag Suggestions
activate Tagger
Tagger -> Tagger : Call AI (Gemini)
Tagger --> Handler : List of Tags
deactivate Tagger

loop For Each Tag
    Handler -> DB : Find or Create Tag
    Handler -> DB : Link Tag to Note
end

Handler --> Controller : Return Note + Tags
deactivate Handler

Controller --> UI : 200 OK
deactivate Controller

UI -> UI : Animate Tag Cloud
UI --> User : Display Note in Library
deactivate UI
@enduml