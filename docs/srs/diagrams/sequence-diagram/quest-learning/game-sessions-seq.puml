@startuml
actor Player
participant QuestManagementUI as UI
participant ":GameSessions\nController" as Controller
participant ":CreateGameSession\nHandler" as Handler
participant ":Subject\nRepository" as SubjectDB
participant ":GameSession\nRepository" as GameDB

Player -> UI : Click "Start Boss Fight"
activate UI

UI -> Controller : POST /sessions/create
activate Controller

Controller -> Handler : Handle(command)
activate Handler

Handler -> SubjectDB : Get Subject Content (Syllabus)
activate SubjectDB
SubjectDB --> Handler : Syllabus JSON
deactivate SubjectDB

Handler -> Handler : Extract & Randomize Questions
note right
    Filter by Difficulty
    Randomize Selection
end note

Handler -> Handler : Build Question Pack JSON

Handler -> GameDB : Create GameSession (Store Pack)
activate GameDB
GameDB --> Handler : SessionId + JoinCode
deactivate GameDB

Handler --> Controller : SessionId + JoinCode
deactivate Handler

Controller --> UI : 200 OK
deactivate Controller

UI -> Controller : GET /sessions/{id}/pack
activate Controller
Controller --> UI : Question Pack JSON
deactivate Controller

UI -> UI : Initialize Game Instance (Unity)
UI --> Player : Load Unity Game Scene
deactivate UI
@enduml