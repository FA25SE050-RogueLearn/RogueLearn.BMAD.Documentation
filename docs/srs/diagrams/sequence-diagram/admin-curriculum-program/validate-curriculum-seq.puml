@startuml
actor Admin
participant ":CurriculumImport\nController" as Controller
participant ":IMediator" as Med
participant ":ValidateCurriculum\nQueryHandler" as Handler
participant ":ICurriculumImportStorage" as Cache
participant ":ICurriculumExtraction\nPlugin" as AIPlugin
participant ":CurriculumImportData\nValidator" as Validator

Admin -> Controller : POST /api/admin/curriculum/validate
activate Controller

Controller -> Med : Send(ValidateCurriculumQuery)
activate Med

Med -> Handler : Handle(query)
activate Handler

' 1. Check Cache
Handler -> Handler : ComputeHash(RawText)
Handler -> Cache : TryGetByHashJsonAsync(Hash)
activate Cache
Cache --> Handler : Cached JSON?
deactivate Cache

alt Cache Miss
    ' 2. AI Extraction
    Handler -> AIPlugin : ExtractCurriculumJsonAsync(RawText)
    activate AIPlugin
    AIPlugin --> Handler : JSON String
    deactivate AIPlugin
end

' 3. Parse & Validate
Handler -> Handler : Deserialize JSON
Handler -> Validator : ValidateAsync(Data)
activate Validator
Validator --> Handler : ValidationResult
deactivate Validator

' 4. Cache Result
alt Is Valid
    Handler -> Cache : SaveLatestAsync(Data, Hash)
    note right: Cache successful parse for later import
end

Handler --> Med : ValidateCurriculumResponse
deactivate Handler

Med --> Controller : Response (JSON Preview)
deactivate Med

Controller --> Admin : 200 OK
deactivate Controller
@enduml