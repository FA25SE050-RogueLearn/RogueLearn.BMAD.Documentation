@startuml
actor Admin
participant ":CurriculumPrograms\nController" as Controller
participant ":IMediator" as Med
participant ":UpdateCurriculumProgram\nCommandHandler" as Handler
participant ":ICurriculumProgram\nRepository" as IRepo
participant ":CurriculumProgram\nRepository" as Repo
database ":Database" as DB

Admin -> Controller : PUT /api/admin/programs/{id}
activate Controller

Controller -> Med : Send(UpdateCurriculumProgramCommand)
activate Med

Med -> Handler : Handle(command)
activate Handler

' 1. Fetch Existing
Handler -> IRepo : GetByIdAsync(Id)
activate IRepo
IRepo -> Repo : GetByIdAsync(Id)
activate Repo
Repo -> DB : SELECT * FROM curriculum_programs...
activate DB
DB --> Repo : Entity
deactivate DB
Repo --> IRepo : Entity
deactivate Repo
IRepo --> Handler : Entity
deactivate IRepo

alt Not Found
    Handler --> Med : Throw NotFoundException
    Med --> Controller : 404 Not Found
else Found
    ' 2. Update Fields
    Handler -> Handler : Update Properties
    note right
        Name, Code, Description,
        DegreeLevel, Credits
        UpdatedAt = UtcNow
    end note

    ' 3. Persist
    Handler -> IRepo : UpdateAsync(Entity)
    activate IRepo
    IRepo -> Repo : UpdateAsync(Entity)
    activate Repo
    Repo -> DB : UPDATE curriculum_programs...
    activate DB
    DB --> Repo : Success
    deactivate DB
    Repo --> IRepo : Updated Entity
    deactivate Repo
    IRepo --> Handler : Updated Entity
    deactivate IRepo

    Handler --> Med : UpdateCurriculumProgramResponse
end

deactivate Handler
Med --> Controller : Response
deactivate Med

Controller --> Admin : 200 OK
deactivate Controller
@enduml