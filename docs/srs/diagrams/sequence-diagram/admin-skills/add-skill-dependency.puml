@startuml
actor Admin
participant AdminManagementUI as UI
participant ":AdminSkillsController" as Controller
participant ":IMediator" as Med
participant ":AddSkillDependency\nHandler" as Handler
participant ":ISkillDependency\nRepository" as IDepRepo
participant ":SkillDependency\nRepository" as DepRepo
database ":Database" as DB

Admin -> UI : Select Prerequisite Skill & Click "Add"
activate UI

UI -> Controller : POST /skills/{id}/dependencies
activate Controller

Controller -> Med : Send(AddSkillDependencyCommand)
activate Med

Med -> Handler : Handle(command)
activate Handler

' 1. Validate
Handler -> Handler : Validate SkillId != PrereqId

' 2. Check Exists
Handler -> IDepRepo : AnyAsync(SkillId, PrereqId)
activate IDepRepo
IDepRepo -> DepRepo : AnyAsync(SkillId, PrereqId)
activate DepRepo
DepRepo -> DB : SELECT 1 FROM skill_dependencies...
activate DB
DB --> DepRepo : Exists?
deactivate DB
DepRepo --> IDepRepo : Exists?
deactivate DepRepo
IDepRepo --> Handler : Exists?
deactivate IDepRepo

alt Exists
    Handler --> Med : Throw ConflictException
else New Dependency
    ' 3. Create
    Handler -> IDepRepo : AddAsync(Dependency)
    activate IDepRepo
    IDepRepo -> DepRepo : AddAsync(Dependency)
    activate DepRepo
    DepRepo -> DB : INSERT INTO skill_dependencies...
    activate DB
    DB --> DepRepo : Success
    deactivate DB
    DepRepo --> IDepRepo : CreatedEntity
    deactivate DepRepo
    IDepRepo --> Handler : CreatedEntity
    deactivate IDepRepo
    
    Handler --> Med : CreatedDto
end

deactivate Handler
Med --> Controller : Response
deactivate Med

Controller --> UI : 201 Created
deactivate Controller

UI -> UI : Refresh Dependencies List
UI --> Admin : Show "Dependency Added" Success
deactivate UI
@enduml