' generate-quest-steps-seq.puml
@startuml
actor Student
participant "Frontend UI" as UI
participant "QuestsController" as Controller
participant "Hangfire\n(Background Job)" as Job
participant "GenerateQuestSteps\nHandler" as Handler
participant "AI & Search\nServices" as Services
participant "Database" as DB

Student -> UI : 1. Click "Start Quest"
UI -> Controller : 2. POST /generate-steps
Controller -> DB : 3. Check if steps exist
alt Exists
    Controller --> UI : 4. Error: Already Generated
else New
    Controller -> Job : 5. Schedule Job
    Job --> Controller : JobId
    Controller --> UI : 6. 202 Accepted
    UI --> Student : 7. Show Loading Spinner
    
    note over Job : Async Execution
    Job -> Handler : 8. Handle(command)
    activate Handler
        Handler -> DB : 9. Build Academic Context
        
        loop Each Week
            Handler -> Services : 10. Search & Validate URLs
            Handler -> Services : 11. Generate AI Content
            Services --> Handler : JSON Data
            Handler -> DB : 12. Save QuestStep
            Handler -> Job : 13. Update Progress
        end
        
    deactivate Handler
end

loop Polling
    UI -> Controller : 14. Check Status
    Controller --> UI : 15. Return Progress
end

UI --> Student : 16. Show Content
@enduml