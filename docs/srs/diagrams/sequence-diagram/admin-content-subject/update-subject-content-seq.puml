@startuml
actor Admin
participant ":SubjectContentEditor\nController" as Controller
participant ":IMediator" as Med
participant ":UpdateSubjectContent\nHandler" as Handler
participant ":ISubjectRepository" as Repo
database ":Database" as DB

Admin -> Controller : PUT /api/admin/subjects/{id}/content
activate Controller

Controller -> Med : Send(UpdateSubjectContentCommand)
activate Med

Med -> Handler : Handle(command)
activate Handler

' 1. Fetch
Handler -> Repo : GetByIdAsync(SubjectId)
activate Repo
Repo -> DB : SELECT * FROM subjects...
DB --> Repo : Subject
deactivate Repo

alt Not Found
    Handler --> Med : Throw NotFoundException
else Found
    ' 2. Serialize & Update
    Handler -> Handler : Serialize Content DTO to JSON
    Handler -> Handler : Deserialize JSON to Dictionary (for DB compatibility)
    
    Handler -> Repo : UpdateAsync(Subject)
    activate Repo
    Repo -> DB : UPDATE subjects SET content = ...
    DB --> Repo : Success
    deactivate Repo

    Handler --> Med : UpdatedContent
end

deactivate Handler
Med --> Controller : Response
deactivate Med

Controller --> Admin : 200 OK
deactivate Controller
@enduml